<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Order Confirmation</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f9f9f9; }
        .container { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 12px; text-align: left; }
        th { background-color: #f0f0f0; }
        .total { font-weight: bold; }
        .footer { margin-top: 30px; font-size: 14px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Order Confirmation - #{{OrderNumber}}</h2>
        <p>Hello {{CustomerName}},</p>
        <p>Thank you for your order! Below are the details of your purchase:</p>

        <p><strong>Order Date:</strong> {{OrderDate}}</p>
        <p><strong>Order Status:</strong> {{OrderStatus}}</p>
        <p><strong>Total Items:</strong> {{TotalItems}}</p>

        <h3>Order Summary:</h3>
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {{OrderRows}}
            </tbody>
        </table>

        <p class="total">Total Order Amount: ₹{{TotalAmount}}</p>

        <div class="footer">
            <p>Thank you for shopping with us!<br/>E-commerce System Team</p>
        </div>
    </div>
</body>
</html>
public class EmailService
{
    private readonly IWebHostEnvironment _env;

    public EmailService(IWebHostEnvironment env)
    {
        _env = env;
    }

    public void SendOrderConfirmationEmail(User user, Order order)
    {
        string templatePath = Path.Combine(_env.WebRootPath, "Templates", "OrderConfirmation.html");
        string html = File.ReadAllText(templatePath);

        string orderRowsHtml = string.Join("", order.Orderitems.Select(item =>
            $"<tr><td>{item.Product?.Name}</td><td>{item.Quantity}</td><td>₹{item.Price}</td><td>₹{item.Quantity * item.Price}</td></tr>"));

        html = html.Replace("{{OrderNumber}}", order.Ordernumber)
                   .Replace("{{CustomerName}}", user.Name)
                   .Replace("{{OrderDate}}", order.Createdat.ToString("dd MMM yyyy"))
                   .Replace("{{OrderStatus}}", order.Orderstatus)
                   .Replace("{{TotalItems}}", order.Totalitems.ToString())
                   .Replace("{{OrderRows}}", orderRowsHtml)
                   .Replace("{{TotalAmount}}", order.Totalamount.ToString("F2"));

        // Convert to PDF
        byte[] pdfBytes = GeneratePdfFromHtml(html);

        // Send email
        var message = new MailMessage("ecommerce@example.com", user.Email)
        {
            Subject = $"Order Placed - #{order.Ordernumber}",
            Body = "Please find your order summary attached.",
            IsBodyHtml = true
        };

        message.Attachments.Add(new Attachment(new MemoryStream(pdfBytes), $"Order_{order.Ordernumber}.pdf"));

        using var smtp = new SmtpClient("smtp.yourserver.com")
        {
            Credentials = new NetworkCredential("yourEmail", "yourPassword"),
            EnableSsl = true
        };
        smtp.Send(message);
    }

    private byte[] GeneratePdfFromHtml(string htmlContent)
    {
        using var ms = new MemoryStream();
        using var doc = new iTextSharp.text.Document();
        var writer = PdfWriter.GetInstance(doc, ms);
        doc.Open();

        using (var sr = new StringReader(htmlContent))
        {
            XMLWorkerHelper.GetInstance().ParseXHtml(writer, doc, sr);
        }

        doc.Close();
        return ms.ToArray();
    }
}
_orderRepository.AddOrder(order);
transaction.Commit();
_orderRepository.EmptyCart(user.Userid);

// Send confirmation email with PDF
_emailService.SendOrderConfirmationEmail(user, order);

return true;
