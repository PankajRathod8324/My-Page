$(document).on("click", ".ModifierCard", function () {
    var modId = $(this).data("modid");

    const existingItemIndex = ItemDetailsArray.findIndex(item => item.ItemId === ItemIdTemp);

    if (existingItemIndex !== -1) {
        let existingModifiers = ItemDetailsArray[existingItemIndex].MenuItemModifier || [];

        if ($(this).hasClass("selected")) {
            // If already selected → remove from modifiers
            existingModifiers = existingModifiers.filter(mod => mod.ModifierId !== modId);
        } else {
            // If not selected → add to modifiers
            existingModifiers.push({ ModifierId: modId });
        }

        // Remove duplicates
        const mergedModifiers = [];
        const ids = new Set();

        existingModifiers.forEach(mod => {
            if (!ids.has(mod.ModifierId)) {
                ids.add(mod.ModifierId);
                mergedModifiers.push(mod);
            }
        });

        ItemDetailsArray[existingItemIndex].MenuItemModifier = mergedModifiers;
    } else {
        // New item push
        ItemDetailsArray.push({
            ItemId: ItemIdTemp,
            MenuItemModifier: [{ ModifierId: modId }]
        });
    }

    console.log(ItemDetailsArray);

    // Toggle classes
    $(this).toggleClass("selected border-primary bg-primary-subtle");
});
