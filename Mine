public List<OrderCategoryVM> GetOrderAllCategoryItem()
{
    var categories = _context.MenuCategories.ToList();

    var result = categories.Select(c => new OrderCategoryVM
    {
        CategoryId = c.CategoryId,
        CategoryName = c.CategoryName,
        Orders = _context.Orders
            .Where(o => _context.OrderItems.Any(oi => oi.OrderId == o.OrderId &&
                                                      oi.ItemId.HasValue &&
                                                      _context.MenuItems.Any(mi => mi.ItemId == oi.ItemId &&
                                                                                  mi.CategoryId == c.CategoryId)))
            .Select(o => new OrderVM
            {
                OrderId = o.OrderId,
                OccupiedTime = DateTime.Now - o.CreatedAt,
                OrderInstruction = o.OrderInstructions,
                OrderItems = _context.OrderItems
                    .Where(oi => oi.OrderId == o.OrderId &&
                                 oi.ItemId.HasValue &&
                                 _context.MenuItems.Any(mi => mi.ItemId == oi.ItemId &&
                                                              mi.CategoryId == c.CategoryId))
                    .Select(oi => new OrderItemVM
                    {
                        ItemId = (int)oi.ItemId,
                        ItemName = _context.MenuItems
                            .Where(item => item.ItemId == oi.ItemId)
                            .Select(item => item.ItemName)
                            .FirstOrDefault(),
                        Price = oi.Rate,
                        Modifiers = _context.OrderModifiers
                            .Where(om => om.OrderItemId == oi.OrderItemId &&
                                         om.ItemId == oi.ItemId)
                            .Select(om => new OrderModifierVM
                            {
                                ModifierId = (int)om.ModifierId,
                                ModifierName = _context.MenuModifiers
                                    .Where(m => m.ModifierId == om.ModifierId)
                                    .Select(m => m.ModifierName)
                                    .FirstOrDefault(),
                                ModifierRate = om.Rate,
                                Quantity = om.Quantity
                            }).ToList(),
                        Quantity = oi.Quantity,
                        ItemInstructions = oi.ItemInstructions,
                    }).ToList(),
                OrderTables = _context.OrderTables
                    .Where(ot => ot.OrderId == o.OrderId)
                    .Select(ot => new OrderTableVM
                    {
                        TableId = (int)ot.TableId,
                        TableName = _context.Tables
                            .Where(t => t.TableId == ot.TableId)
                            .Select(t => t.TableName)
                            .FirstOrDefault(),
                        SectionName = _context.Tables
                            .Where(t => t.TableId == ot.TableId)
                            .Join(_context.Sections,
                                t => t.SectionId,
                                s => s.SectionId,
                                (t, s) => s.SectionName)
                            .FirstOrDefault()
                    }).ToList(),
            }).ToList()
    })
    .Where(c => c.Orders.Any())  // filter only if orders exist
    .ToList();

    return result;
}
