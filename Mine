[HttpGet]
public IActionResult CreateCheckoutSession()
{
    StripeConfiguration.ApiKey = _configuration["Stripe:SecretKey"];

    decimal amount = Convert.ToDecimal(TempData["TotalAmount"]);
    TempData.Keep("TotalAmount");
    TempData.Keep("CartItems");
    TempData.Keep("PaymentMethod");

    var options = new Stripe.Checkout.SessionCreateOptions
    {
        PaymentMethodTypes = new List<string> { "card" },
        Mode = "payment",
        LineItems = new List<SessionLineItemOptions>
        {
            new SessionLineItemOptions
            {
                PriceData = new SessionLineItemPriceDataOptions
                {
                    Currency = "inr",
                    UnitAmount = (long?)amount,
                    ProductData = new SessionLineItemPriceDataProductDataOptions
                    {
                        Name = "Order Payment"
                    },
                },
                Quantity = 1
            },
        },
        SuccessUrl = $"{Request.Scheme}://{Request.Host}/Payment/Success?session_id={{CHECKOUT_SESSION_ID}}",
        CancelUrl = $"{Request.Scheme}://{Request.Host}/Payment/Failed",
    };

    var service = new Stripe.Checkout.SessionService();
    var session = service.Create(options);

    return Json(new { id = session.Id });
}
