public string GetOrdersJson(int categoryId, string? status)
{
    using var connection = new NpgsqlConnection(_connectionString);
    connection.Open();

    // Step 1: Call the procedure
    using (var callCommand = new NpgsqlCommand("CALL get_order_vm_data_json(@p_category_id, @p_status, @json_result)", connection))
    {
        callCommand.Parameters.AddWithValue("p_category_id", categoryId);
        callCommand.Parameters.AddWithValue("p_status", (object?)status ?? DBNull.Value);
        callCommand.Parameters.Add(new NpgsqlParameter("json_result", NpgsqlTypes.NpgsqlDbType.Json)
        {
            Direction = ParameterDirection.Output
        });

        callCommand.ExecuteNonQuery();
    }

    // Step 2: Fetch the OUT value
    using (var selectCommand = new NpgsqlCommand("SELECT json_result;", connection))
    {
        using var reader = selectCommand.ExecuteReader();
        if (reader.Read())
        {
            return reader.GetString(0);
        }
    }

    return string.Empty;
}
