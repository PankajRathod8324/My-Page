public List<OrderVM> GetOrderViewModelData(int categoryId, string status)
{
    using var connection = new NpgsqlConnection(_connectionString);
    connection.Open();

    using var transaction = connection.BeginTransaction();

    // Step 1: Execute stored procedure that creates/fills the temp table
    using (var command = new NpgsqlCommand("CALL get_order_vm_data_temp(@p_category_id, @p_status);", connection, transaction))
    {
        command.Parameters.AddWithValue("p_category_id", categoryId);
        command.Parameters.AddWithValue("p_status", (object?)status ?? DBNull.Value);
        command.ExecuteNonQuery();
    }

    // Step 2: Query the temp table using the same transaction
    var result = connection.Query<OrderVM>(
        "SELECT * FROM temp_order_vm_data;",
        transaction: transaction
    ).ToList();

    transaction.Commit();

    return result;
}
